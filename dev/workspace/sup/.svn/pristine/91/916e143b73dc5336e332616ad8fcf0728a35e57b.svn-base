<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="EgovContentDAO">

	<resultMap id="clist"
		type="egovframework.com.admin.cop.bbs.service.ContentVO">
		<result property="BANNER_ID" column="BANNER_ID" />
		<result property="BANNER_NM" column="BANNER_NM" />
		<result property="LINK_URL" column="LINK_URL" />
		<result property="BANNER_IMAGE" column="BANNER_IMAGE" />
		<result property="BANNER_DC" column="BANNER_DC" />
		<result property="REFLCT_AT" column="REFLCT_AT" />
		<result property="FRST_REGISTER_ID" column="FRST_REGISTER_ID" />
		<result property="FRST_REGIST_PNTTM" column="FRST_REGIST_PNTTM" />
		<result property="LAST_UPDUSR_ID" column="LAST_UPDUSR_ID" />
		<result property="LAST_UPDT_PNTTM" column="LAST_UPDT_PNTTM" />
		<result property="BANNER_IMAGE_FILE" column="BANNER_IMAGE_FILE" />
		<result property="SORT_ORDR" column="SORT_ORDR" />
		<result property="NTT_NO" column="NTT_NO" />
		<result property="POSITION" column="POSITION" />
		<result property="FDATE" column="FDATE" />
		<result property="SDATE" column="SDATE" />
		<result property="TITLE" column="TITLE" />
		<result property="FTYPE" column="FTYPE" />
		<result property="RANK" column="RANK" />
	</resultMap>

	<resultMap id="blist" type="egovframework.com.cmm.BoardVO">
		<result property='NTT_ID' column='NTT_ID' />
		<result property='BBS_ID' column='BBS_ID' />
		<result property='NTT_NO' column='NTT_NO' />
		<result property='NTT_SJ' column='NTT_SJ' />
		<result property='NTT_CN' column='NTT_CN' />
		<result property='ANSWER_AT' column='ANSWER_AT' />
		<result property='PARNTSCTT_NO' column='PARNTSCTT_NO' />
		<result property='ANSWER_LC' column='ANSWER_LC' />
		<result property='SORT_ORDR' column='SORT_ORDR' />
		<result property='USE_AT' column='USE_AT' />
		<result property='RDCNT' column='RDCNT' />
		<result property='NTCE_BGNDE' column='NTCE_BGNDE' />
		<result property='NTCE_ENDDE' column='NTCE_ENDDE' />
		<result property='NTCR_ID' column='NTCR_ID' />
		<result property='NTCR_NM' column='NTCR_NM' />
		<result property='PASSWORD' column='PASSWORD' />
		<result property='ATCH_FILE_ID' column='ATCH_FILE_ID' />
		<result property='FRST_REGIST_PNTTM' column='FRST_REGIST_PNTTM' />
		<result property='FRST_REGISTER_ID' column='FRST_REGISTER_ID' />
		<result property='LAST_UPDT_PNTTM' column='LAST_UPDT_PNTTM' />
		<result property='LAST_UPDUSR_ID' column='LAST_UPDUSR_ID' />
		<result property='POSITION' column='POSITION' />
		<result property='TITLE' column='TITLE' />
		<result property='PTB' column='PTB' />
		<result property='FTYPE' column='FTYPE' />
		<result property='TERM' column='TERM' />
		<result property='PUSHDATE' column='PUSHDATE' />
		<result property='THUMBNAIL' column='THUMBNAIL' />
		<result property='ATTACHMENT' column='ATTACHMENT' />
		<result property='CONTENT' column='CONTENT' />
		<result property='VIDEO' column='VIDEO' />
		<result property='HEAD_SIGN' column='HEAD_SIGN' />
		<result property='ONOFF' column='ONOFF' />
		<result property='MBER_ID' column='MBER_ID' />
		<result property='APPROVAL' column='APPROVAL' />
		<result property='BOOK_DATE' column='BOOK_DATE' />
		<result property='PRICE' column='PRICE' />
		<result property='CNT' column='CNT' />
		<result property='FDATE' column='FDATE' />
		<result property='SDATE' column='SDATE' />
		<result property='FDAY' column='FDAY' />
		<result property='SDAY' column='SDAY' />
		<result property='FTIME' column='FTIME' />
		<result property='STIME' column='STIME' />
		<result property='COMPANIES' column='COMPANIES' />
		<result property='EMAIL_AGREE' column='EMAIL_AGREE' />
		<result property='TEAMNAME' column='TEAMNAME' />
		<result property='CRNUM' column='CRNUM' />
		<result property='TEAMCONTENT' column='TEAMCONTENT' />
		<result property='ADDRESS' column='ADDRESS' />
		<result property='EVENTNAME' column='EVENTNAME' />
		<result property='TARGET' column='TARGET' />
		<result property='ENTRYFEE' column='ENTRYFEE' />
		<result property='ITEM' column='ITEM' />
		<result property='AFFILIATION' column='AFFILIATION' />
		<result property='TEL_SEC' column='TEL_SEC' />
		<result property='FOBJECT' column='FOBJECT' />
		<result property='STARTING' column='STARTNG' />
		<result property='REQUEST' column='REQUEST' />
		<result property='REQURIEMENT' column='REQURIEMENT' />
		<result property='BUS' column='BUS' />
		<result property='NAME' column='NAME' />
		<result property='SIMPLECONTENT' column='SIMPLECONTENT' />
		<result property='PLACE' column='PLACE' />
		<result property='MIMAGE' column='MIMAGE' />
		<result property='IMAGE' column='IMAGE' />
		<result property='DETAIL' column='DETAIL' />
		<result property='FFILE' column='FFILE' />
		<result property='RUNTIME' column='RUNTIME' />
		<result property='FYEAR' column='FYEAR' />
		<result property='CAPTAINNAME' column='CAPTAINNAME' />
		<result property='FORM' column='FORM' />
		<result property='MAKEYEAR' column='MAKEYEAR' />
		<result property='FLOOR' column='FLOOR' />
		<result property='ROOM' column='ROOM' />
		<result property='MOVEDATE' column='MOVEDATE' />
		<result property='MOVEPLAN' column='MOVEPLAN' />
		<result property='ITEM_OBJECT' column='ITEM_OBJECT' />
		<result property='ITEM_SUBJECT' column='ITEM_SUBJECT' />
		<result property='CHARGE_TEL' column='CHARGE_TEL' />
		<result property='OFFICE_TEL' column='OFFICE_TEL' />
		<result property='EMAIL' column='EMAIL' />
		<result property='HOMEPAGE' column='HOMEPAGE' />
		<result property='LOGO' column='LOGO' />
		<result property='ITEM_IMAGE' column='ITEM_IMAGE' />
		<result property='INTRO' column='INTRO' />
		<result property='lname' column='lname' />
		<result property='tel' column='tel' />
		<result property='email' column='email' />
	</resultMap>

	<resultMap id="login" type="egovframework.com.cmm.LoginVO">
		<result property="id" column="id" />
		<result property="name" column="name" />
		<result property="ihidNum" column="ihidNum" />
		<result property="email" column="email" />
		<result property="password" column="password" />
		<result property="userSe" column="userSe" />
		<result property="orgnztId" column="orgnztId" />
		<result property="uniqId" column="uniqId" />
		<result property="tel" column="tel" />
		<result property="sbscrb_de" column="sbscrb_de" />
	</resultMap>

	<select id="ContentSelect" resultMap="clist" parameterType="cvo">
		SELECT
		RANK,BANNER_ID,BANNER_NM,LINK_URL,BANNER_IMAGE,BANNER_DC,REFLCT_AT,
		FRST_REGISTER_ID,FRST_REGIST_PNTTM,LAST_UPDUSR_ID,
		LAST_UPDT_PNTTM,BANNER_IMAGE_FILE,SORT_ORDR,NTT_NO,
		POSITION,DATE_FORMAT(FDATE, '%Y-%m-%d') 
		as FDATE, DATE_FORMAT(SDATE, '%Y-%m-%d') as
		SDATE,TITLE,FTYPE
		FROM COMTNBANNER
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			<if test='NTT_NO != "all"'>
				AND NTT_NO like concat('%' , #{NTT_NO} , '%')
			</if>
			<if test="REFLCT_AT != null">
				AND NVL(REFLCT_AT, '0') != '1'
			</if>
		</trim>
		order by RANK
	</select>

	<insert id="ContentInsert" parameterType="cvo">
		insert into
		COMTNBANNER(BANNER_IMAGE,RANK,TITLE,BANNER_ID,BANNER_NM,LINK_URL,REFLCT_AT,FRST_REGISTER_ID,FRST_REGIST_PNTTM,LAST_UPDUSR_ID,LAST_UPDT_PNTTM,BANNER_IMAGE_FILE,NTT_NO,POSITION,FDATE,SDATE)
		values(#{BANNER_IMAGE},#{RANK},#{TITLE},bannerseq.nextval,#{BANNER_NM},#{LINK_URL},#{REFLCT_AT},#{FRST_REGISTER_ID},SYSDATE,#{LAST_UPDUSR_ID},SYSDATE,#{BANNER_IMAGE_FILE},#{NTT_NO},#{POSITION},#{FDATE},#{SDATE})
	</insert>

	<update id="ContentUpdate" parameterType="cvo">
		update COMTNBANNER
		set
		LINK_URL = #{LINK_URL}, REFLCT_AT=#{REFLCT_AT}, LAST_UPDUSR_ID =
		#{LAST_UPDUSR_ID}, BANNER_IMAGE_FILE = #{BANNER_IMAGE_FILE},
		LAST_UPDT_PNTTM = sysdate,
		POSITION = #{POSITION},FDATE = #{FDATE},
		SDATE = #{SDATE}, TITLE = #{TITLE}

		where BANNER_NM = #{BANNER_NM}
	</update>

	<!-- 배너 사용유무 변경 -->
	<update id="updateBannerUseYn" parameterType="cvo">
		update COMTNBANNER
		set REFLCT_AT = #{REFLCT_AT}
		,LAST_UPDUSR_ID = #{LAST_UPDUSR_ID}
		, LAST_UPDT_PNTTM = sysdate
		where BANNER_ID = #{BANNER_ID}
	</update>

	<update id="atUpdate" parameterType="cvo">
		update COMTNBANNER
		set
		REFLCT_AT=#{REFLCT_AT}, LAST_UPDUSR_ID = #{LAST_UPDUSR_ID},
		LAST_UPDT_PNTTM = sysdate
		where BANNER_NM = #{BANNER_NM}
	</update>
	<!-- 회원 조회 -->
	<select id="infoSelect" resultType="egovframework.com.cmm.LoginVO"
		parameterType="egovframework.com.cmm.LoginVO">
		SELECT mber_id AS id
		, mber_nm AS name
		, ihidNum AS ihidNum
		, password AS password
		, mber_email_adres AS email
		, 'GNR' AS userSe
		, '-' AS orgnztId
		, esntl_id AS uniqId
		, MBTLNUM as tel
		, DATE_FORMAT(sbscrb_de, '%Y-%m-%d %H:%i:%s') AS RDATE<!-- 가입일시 -->
		FROM COMTNGNRLMBER
		WHERE mber_id = #{id}
	</select>
	<select id="infoSelectAll" resultMap="login">
		SELECT mber_id AS id
		, mber_nm AS name
		, ihidNum AS ihidNum
		, password AS password
		, mber_email_adres AS email
		, 'GNR' AS userSe
		, '-' AS orgnztId
		, esntl_id AS uniqId
		, MBTLNUM as tel
		FROM COMTNGNRLMBER
		order by mber_id
	</select>


	<insert id="boardInsert" parameterType="bvo">
		insert into COMTNBBS
		(NTT_ID
		,BBS_ID
		,NTT_NO
		,NTT_SJ
		,NTT_CN
		,ANSWER_AT
		,PARNTSCTT_NO
		,ANSWER_LC
		,SORT_ORDR
		,USE_AT
		,RDCNT
		,NTCE_BGNDE
		,NTCE_ENDDE
		,NTCR_ID
		,NTCR_NM
		,PASSWORD
		,ATCH_FILE_ID
		,FRST_REGIST_PNTTM
		,FRST_REGISTER_ID
		,LAST_UPDT_PNTTM
		,LAST_UPDUSR_ID
		,POSITION
		,TITLE
		,PTB
		,FTYPE
		,TERM
		,PUSHDATE
		,THUMBNAIL
		,ATTACHMENT
		,CONTENT
		,VIDEO
		,HEAD_SIGN
		,MBER_ID
		,APPROVAL
		,BOOK_DATE
		,PRICE
		,CNT
		,FDATE
		,SDATE
		,FDAY
		,SDAY
		,FTIME
		,STIME
		,COMPANIES
		,EMAIL_AGREE
		,TEAMNAME
		,CRNUM
		,TEAMCONTENT
		,ADDRESS
		,EVENTNAME
		,TARGET
		,ENTRYFEE
		,ITEM
		,AFFILIATION
		,TEL_SEC
		,FOBJECT
		,STARTNG
		,REQUEST
		,REQURIEMENT
		,BUS
		,NAME
		,SIMPLECONTENT
		,PLACE
		,MIMAGE
		,IMAGE
		,DETAIL
		,RUNTIME
		,FYEAR
		,CAPTAINNAME
		,FORM
		,MAKEYEAR
		,FLOOR
		,ROOM
		,MOVEDATE
		,MOVEPLAN
		,ITEM_OBJECT
		,ITEM_SUBJECT
		,CHARGE_TEL
		,OFFICE_TEL
		,EMAIL
		,HOMEPAGE
		,LOGO
		,ITEM_IMAGE
		,INTRO
		,FFILE
		)
		values
		(#{NTT_ID}
		,seq_content.nextval
		,#{NTT_NO}
		,#{NTT_SJ}
		,#{NTT_CN}
		,#{ANSWER_AT}
		,#{PARNTSCTT_NO}
		,#{ANSWER_LC}
		,#{SORT_ORDR}
		,'5'
		,0
		,#{NTCE_BGNDE}
		,#{NTCE_ENDDE}
		,#{NTCR_ID}
		,#{NTCR_NM}
		,#{PASSWORD}
		,#{ATCH_FILE_ID}
		,SYSDATE
		,#{FRST_REGISTER_ID}
		,SYSDATE
		,#{LAST_UPDUSR_ID}
		,#{POSITION}
		,#{TITLE}
		,#{PTB}
		,#{FTYPE}
		,#{TERM}
		,SYSDATE
		,#{THUMBNAIL}
		,#{ATTACHMENT}
		,#{CONTENT}
		,#{VIDEO}
		,#{HEAD_SIGN}
		,#{MBER_ID}
		,#{APPROVAL}
		,#{BOOK_DATE}
		,#{PRICE}
		,#{CNT}
		,#{FDATE}
		,#{SDATE}
		,#{FDAY}
		,#{SDAY}
		,#{FTIME}
		,#{STIME}
		,#{COMPANIES}
		,#{EMAIL_AGREE}
		,#{TEAMNAME}
		,#{CRNUM}
		,#{TEAMCONTENT}
		,#{ADDRESS}
		,#{EVENTNAME}
		,#{TARGET}
		,#{ENTRYFEE}
		,#{ITEM}
		,#{AFFILIATION}
		,#{TEL_SEC}
		,#{FOBJECT}
		,#{STARTING}
		,#{REQUEST}
		,#{REQURIEMENT}
		,#{BUS}
		,#{NAME}
		,#{SIMPLECONTENT}
		,#{PLACE}
		,#{MIMAGE}
		,#{IMAGE}
		,#{DETAIL}
		,#{RUNTIME}
		,#{FYEAR}
		,#{CAPTAINNAME}
		,#{FORM}
		,#{MAKEYEAR}
		,#{FLOOR}
		,#{ROOM}
		,#{MOVEDATE}
		,#{MOVEPLAN}
		,#{ITEM_OBJECT}
		,#{ITEM_SUBJECT}
		,#{CHARGE_TEL}
		,#{OFFICE_TEL}
		,#{EMAIL}
		,#{HOMEPAGE}
		,#{LOGO}
		,#{ITEM_IMAGE}
		,#{INTRO}
		,#{FFILE}

		)
	</insert>

	<delete id="boardDelete" parameterType="String">
		delete COMTNBBS
		where
		BBS_ID = #{BBS_ID}
	</delete>
	
	<delete id="reservDelete" parameterType="String">
		delete COMTNBBS
		where
		BBS_ID = #{BBS_ID}
	</delete>
	
	<update id="qnaUpdate">
		update COMTNBBS
		set PTB = #{PTB}
		where BBS_ID=#{BBS_ID}
	</update>

	<!-- <select id="NTTSelect" parameterType="bvo" resultMap="blist"> select 
		NTT_ID,BBS_ID,NTT_NO,NTT_SJ,MIMAGE,NTT_CN,ANSWER_AT,PARNTSCTT_NO,ANSWER_LC,SORT_ORDR,USE_AT,RDCNT,NTCE_BGNDE,NTCE_ENDDE,NTCR_ID,NTCR_NM,PASSWORD,ATCH_FILE_ID,FRST_REGIST_PNTTM,FRST_REGISTER_ID,LAST_UPDT_PNTTM,LAST_UPDUSR_ID,POSITION,TITLE,PTB,FTYPE,TERM,DATE_FORMAT(PUSHDATE, '%Y-%m-%d'),THUMBNAIL,ATTACHMENT,CONTENT,VIDEO,HEAD_SIGN,ONOFF,MBER_ID,APPROVAL,BOOK_DATE,PRICE,CNT,DATE_FORMAT(FDATE, '%Y-%m-%d') as 
		FDATE,DATE_FORMAT(SDATE, '%Y-%m-%d')as SDATE,FDAY,SDAY,FTIME,STIME,COMPANIES,EMAIL_AGREE,TEAMNAME,CRNUM,TEAMCONTENT,ADDRESS,EVENTNAME,TARGET,ENTRYFEE,ITEM,AFFILIATION,TEL_SEC,FOBJECT,STARTNG,REQUEST,REQURIEMENT,BUS,NAME,SIMPLECONTENT,PLACE,IMAGE,DETAIL,FFILE,RUNTIME,FYEAR,CAPTAINNAME,FORM,MAKEYEAR,FLOOR,ROOM,MOVEDATE,MOVEPLAN,ITEM_OBJECT,ITEM_SUBJECT,CHARGE_TEL,OFFICE_TEL,EMAIL,HOMEPAGE,LOGO,ITEM_IMAGE,INTRO 
		from COMTNBBS WHERE NTT_ID = #{NTT_ID} </select> <select id="BBSSelect" parameterType="bvo" 
		resultMap="blist"> select NTT_ID,BBS_ID,NTT_NO,NTT_SJ,MIMAGE,NTT_CN,ANSWER_AT,PARNTSCTT_NO,ANSWER_LC,SORT_ORDR,USE_AT,RDCNT,NTCE_BGNDE,NTCE_ENDDE,NTCR_ID,NTCR_NM,PASSWORD,ATCH_FILE_ID,FRST_REGIST_PNTTM,FRST_REGISTER_ID,LAST_UPDT_PNTTM,LAST_UPDUSR_ID,POSITION,TITLE,PTB,FTYPE,TERM,to_char(PUSHDATE,'yyyy-mm-dd'),THUMBNAIL,ATTACHMENT,CONTENT,VIDEO,HEAD_SIGN,ONOFF,MBER_ID,APPROVAL,BOOK_DATE,PRICE,CNT,DATE_FORMAT(FDATE, '%Y-%m-%d')as 
		FDATE,DATE_FORMAT(SDATE, '%Y-%m-%d')as SDATE,FDAY,SDAY,FTIME,STIME,COMPANIES,EMAIL_AGREE,TEAMNAME,CRNUM,TEAMCONTENT,ADDRESS,EVENTNAME,TARGET,ENTRYFEE,ITEM,AFFILIATION,TEL_SEC,FOBJECT,STARTNG,REQUEST,REQURIEMENT,BUS,NAME,SIMPLECONTENT,PLACE,IMAGE,DETAIL,FFILE,RUNTIME,FYEAR,CAPTAINNAME,FORM,MAKEYEAR,FLOOR,ROOM,MOVEDATE,MOVEPLAN,ITEM_OBJECT,ITEM_SUBJECT,CHARGE_TEL,OFFICE_TEL,EMAIL,HOMEPAGE,LOGO,ITEM_IMAGE,INTRO 
		from COMTNBBS where BBS_ID = #{BBS_ID} </select> -->
	<select id="pkSelect" resultType="Integer">
		select fileupload.nextval from
		dual
	</select>
	<update id="stupdate" parameterType="bvo">
		update COMTNBBS
		set
		ONOFF=#{ONOFF}
		where BBS_ID = #{BBS_ID}
	</update>
	<update id="atonUpdate" parameterType="bvo">
		update COMTNBBS
		SET LAST_UPDT_PNTTM = sysdate
		<if test="ONOFF != null or ONOFF != ''">
			, ONOFF = #{ONOFF}
		</if>
		<if test="USE_AT != null or USE_AT != ''">
			, USE_AT = #{USE_AT}
		</if>
		where BBS_ID = #{BBS_ID}
	</update>

	<select id="selectcal" parameterType="bvo" resultMap="blist">
		select
		a.NTT_ID as NTT_ID,a.CNT as CNT,a.RDCNT as RDCNT, a.BBS_ID as BBS_ID,
		a.TITLE as TITLE, a.FTYPE as FTYPE,
		a.TEAMNAME as TEAMNAME,
		DATE_FORMAT(a.FDATE, '%Y-%m-%d') as FDATE, DATE_FORMAT(a.SDATE, '%Y-%m-%d')
		as SDATE,
		a.FDAY as FDAY, a.FTIME as FTIME, a.STIME as STIME,
		DECODE(a.ONOFF , 'Y' ,
		'승인' , 'N', '거절') as ONOFF, a.MBER_ID as MBER_ID, b.MBER_NM as lname,
		b.MBTLNUM as tel, b.MBER_EMAIL_ADRES as email
		from COMTNBBS a, COMTNGNRLMBER b
		where a.MBER_ID = b.MBER_ID and
		NTT_ID = #{NTT_ID}
		order by PUSHDATE DESC
	</select>
	<select id="selectTable" parameterType="bvo" resultMap="blist">
		select
		a.NTT_ID as NTT_ID,a.NTT_NO as NTT_NO,a.CNT as CNT,a.RDCNT as RDCNT,
		a.BBS_ID as BBS_ID, a.TITLE as TITLE, a.FTYPE as FTYPE,
		a.TEAMNAME as
		TEAMNAME, DATE_FORMAT(a.FDATE, '%Y-%m-%d') as FDATE,
		DATE_FORMAT(a.SDATE, '%Y-%m-%d') as SDATE,
		a.FDAY as FDAY, a.FTIME as FTIME, a.STIME as STIME,
		DECODE(a.ONOFF , 'Y' ,
		'승인' , 'N', '거절') as ONOFF, a.MBER_ID as MBER_ID, b.MBER_NM as lname,
		b.MBTLNUM as tel, b.MBER_EMAIL_ADRES as email
		from COMTNBBS a, COMTNGNRLMBER b
		where a.MBER_ID = b.MBER_ID and
		NTT_ID = #{NTT_ID} and FDATE = #{PUSHDATE}
		order by PUSHDATE DESC
	</select>

	<select id="selectTableDetail" parameterType="bvo" resultType="bvo">
		select a.NTT_ID as NTT_ID,a.CNT as CNT,a.RDCNT as RDCNT, a.BBS_ID as
		BBS_ID, a.TITLE as TITLE, a.FTYPE as FTYPE,
		a.TEAMNAME as TEAMNAME,
		DATE_FORMAT(a.FDATE, '%Y-%m-%d') as FDATE, DATE_FORMAT(a.SDATE, '%Y-%m-%d')
		as SDATE,
		a.FDAY as FDAY, a.FTIME as FTIME, a.STIME as STIME,
		DECODE(a.ONOFF , 'Y' ,
		'승인' , 'N', '거절') as ONOFF, a.MBER_ID as MBER_ID, b.MBER_NM as lname,
		b.MBTLNUM as tel, b.MBER_EMAIL_ADRES as email
		from COMTNBBS a, COMTNGNRLMBER b
		where a.MBER_ID = b.MBER_ID and
		BBS_ID = #{BBS_ID}
		order by PUSHDATE DESC
	</select>


	<select id="selectTITLE" parameterType="bvo" resultMap="blist">
		select
		TITLE from COMTNBBS
		where NTT_ID = #{NTT_ID} and FDATE = #{PUSHDATE}
		group by TITLE
	</select>
</mapper>